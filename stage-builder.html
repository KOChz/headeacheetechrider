<style>
  #stageContainer {
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    position: relative;
    overflow: hidden;
  }

  #canvas {
    touch-action: none;
    display: block;
  }

  .stage-node {
    cursor: move;
    user-select: none;
  }

  .panning {
    cursor: grabbing !important;
  }

  .panning * {
    cursor: grabbing !important;
  }

  .stage-plan-section {
    background: var(--color-bg);
    padding: var(--spacing-xl) 0;
  }

  .canvas-wrapper {
    position: relative;
    width: 100%;
    height: 70vh;
    min-height: 500px;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    overflow: hidden;
  }

  .canvas-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    cursor: grab;
  }

  .canvas-container.panning {
    cursor: grabbing;
  }

  #canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .stage-controls {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .control-group {
    display: flex;
    gap: 8px;
  }

  .stage-btn {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    color: var(--color-text);
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all var(--transition-base);
    font-weight: 500;
    font-family: var(--font-sans);
  }

  .stage-btn:hover {
    background: var(--color-surface-hover);
    border-color: var(--color-dark-green);
  }

  .stage-btn:active {
    transform: translateY(1px);
  }

  .stage-info {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(26, 26, 26, 0.95);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 12px 16px;
    font-family: var(--font-mono);
    font-size: 12px;
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .info-line {
    margin: 4px 0;
    color: var(--color-text-muted);
  }

  .info-value {
    color: var(--color-dark-green);
    font-weight: 600;
  }

  .stage-node {
    cursor: move;
    transition: filter var(--transition-base);
  }

  .stage-node:hover {
    filter: brightness(1.2);
  }

  .stage-node:active {
    cursor: grabbing;
  }

  .node-text {
    fill: var(--color-text);
    font-size: 14px;
    font-weight: 600;
    text-anchor: middle;
    pointer-events: none;
    user-select: none;
    font-family: var(--font-sans);
  }

  .node-coords {
    fill: var(--color-text-muted);
    font-size: 10px;
    font-family: var(--font-mono);
    text-anchor: middle;
    pointer-events: none;
    user-select: none;
  }

  .grid-line {
    stroke: var(--color-border);
    stroke-width: 1;
  }

  .grid-line-major {
    stroke: #3a3a3a;
    stroke-width: 1.5;
  }

  .axis-line {
    stroke: #4a4a4a;
    stroke-width: 2;
  }

  @media (max-width: 768px) {
    .canvas-wrapper {
      height: 50vh;
      min-height: 400px;
    }

    .stage-controls {
      top: 10px;
      right: 10px;
      padding: 12px;
    }

    .stage-info {
      bottom: 10px;
      left: 10px;
      padding: 8px 12px;
      font-size: 11px;
    }

    .section-title {
      font-size: 2rem;
    }
  }

  @media (max-width: 480px) {
    .canvas-wrapper {
      height: 60vh;
      min-height: 350px;
    }

    .stage-controls {
      padding: 8px;
    }

    .stage-btn {
      padding: 6px 12px;
      font-size: 12px;
    }
  }

  .stage-node .rotation-handle,
  .stage-node .rotation-icon {
    transition: opacity 0.1s ease 0.1s; /* 0.1s delay before hiding */
  }
</style>

<section id="stage-plan" class="stage-plan-section">
  <div class="container">
    <h2 class="section-title">Stage Plan</h2>
    <p class="section-subtitle">
      Interactive stage layout - pan, zoom, and drag equipment positions
    </p>

    <div class="canvas-wrapper">
      <div class="canvas-container" id="stageContainer">
        <svg id="canvas" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <pattern
              id="grid"
              width="50"
              height="50"
              patternUnits="userSpaceOnUse"
            >
              <line x1="0" y1="0" x2="0" y2="50" class="grid-line" />
              <line x1="0" y1="0" x2="50" y2="0" class="grid-line" />
            </pattern>
            <pattern
              id="grid-major"
              width="200"
              height="200"
              patternUnits="userSpaceOnUse"
            >
              <rect width="200" height="200" fill="url(#grid)" />
              <line x1="0" y1="0" x2="0" y2="200" class="grid-line-major" />
              <line x1="0" y1="0" x2="200" y2="0" class="grid-line-major" />
            </pattern>

            <!-- Drumkit Symbol -->
            <symbol id="drumkit" viewBox="0 0 1024 1024">
              <path d="M783.744 200.64h38.528V908.16h-38.528z" fill="#C2C7E5" />
              <path
                d="M822.272 187.584v-18.176h-38.528v18.176h-99.264v35.52h236.992v-35.52zM684.48 251.648h236.992v35.52h-236.992z"
                fill="#F5BB1B"
              />
              <path d="M218.496 200.64h38.528V908.16h-38.528z" fill="#C2C7E5" />
              <path
                d="M135.168 138.624l218.88 91.2-13.696 32.832-218.88-91.2z"
                fill="#F5BB1B"
              />
              <path d="M73.024 347.392h317.568v35.52H73.024z" fill="#35464E" />
              <path d="M88.448 382.848h286.784v135.68H88.448z" fill="#E72845" />
              <path d="M73.024 518.656h317.568v35.648H73.024z" fill="#35464E" />
              <path d="M88.448 382.848h286.784v39.104H88.448z" fill="#C7161E" />
              <path
                d="M135.872 382.848h42.048v92.416h-42.048zM286.912 382.848h42.112v92.416h-42.112z"
                fill="#35464E"
              />
              <path
                d="M644.16 347.392h317.568v35.52h-317.568z"
                fill="#35464E"
              />
              <path
                d="M659.648 382.848h286.72v135.68h-286.72z"
                fill="#E72845"
              />
              <path
                d="M644.16 518.656h317.568v35.648h-317.568z"
                fill="#35464E"
              />
              <path
                d="M659.648 382.848h286.72v39.104h-286.72z"
                fill="#C7161E"
              />
              <path
                d="M707.008 382.848h41.984v92.416h-41.984zM858.112 382.848h41.984v92.416h-41.984z"
                fill="#35464E"
              />
              <path
                d="M727.36 880.192l-33.408 27.84-52.352-62.72 33.344-27.84zM366.912 817.472l33.408 27.84-52.352 62.72-33.472-27.84z"
                fill="#C2C7E5"
              />
              <path
                d="M521.664 671.424m-224.96 0a224.96 224.96 0 1 0 449.92 0 224.96 224.96 0 1 0-449.92 0Z"
                fill="#526C78"
              />
              <path
                d="M521.664 914.176a242.944 242.944 0 0 1-242.688-242.752 242.944 242.944 0 0 1 242.688-242.688 242.944 242.944 0 0 1 242.688 242.688 242.944 242.944 0 0 1-242.688 242.752z m0-449.856a207.36 207.36 0 0 0-207.168 207.104c0 114.24 92.928 207.168 207.168 207.168s207.232-92.928 207.232-207.168a207.424 207.424 0 0 0-207.232-207.104z"
                fill="#263137"
              />
            </symbol>

            <!-- ============================================
           AMPLIFIER SYMBOL (Your existing design)
           ============================================ -->
            <symbol id="amp" viewBox="0 0 50 50">
              <defs>
                <linearGradient
                  id="ampBodyGradient"
                  x1="0%"
                  y1="0%"
                  x2="0%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #2a2a2a; stop-opacity: 1"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #1a1a1a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #0a0a0a; stop-opacity: 1"
                  />
                </linearGradient>
                <linearGradient
                  id="grilleGradient"
                  x1="0%"
                  y1="0%"
                  x2="0%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #4a4a4a; stop-opacity: 1"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #3a3a3a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #2a2a2a; stop-opacity: 1"
                  />
                </linearGradient>
                <radialGradient id="knobGradient">
                  <stop
                    offset="0%"
                    style="stop-color: #ffd700; stop-opacity: 1"
                  />
                  <stop
                    offset="70%"
                    style="stop-color: #b8860b; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #8b6914; stop-opacity: 1"
                  />
                </radialGradient>
              </defs>

              <rect
                x="3"
                y="6"
                width="44"
                height="38"
                rx="2"
                fill="url(#ampBodyGradient)"
                stroke="#000"
                stroke-width="0.5"
              />
              <path
                d="M 15 6 Q 15 3 25 3 Q 35 3 35 6"
                fill="none"
                stroke="#1a1a1a"
                stroke-width="2"
              />
              <rect
                x="5"
                y="8"
                width="40"
                height="6"
                rx="1"
                fill="#1a1a1a"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
              <circle cx="9" cy="11" r="1" fill="#ff4444" opacity="0.8" />
              <circle
                cx="16"
                cy="11"
                r="1.2"
                fill="url(#knobGradient)"
                stroke="#8b6914"
                stroke-width="0.3"
              />
              <circle
                cx="22"
                cy="11"
                r="1.2"
                fill="url(#knobGradient)"
                stroke="#8b6914"
                stroke-width="0.3"
              />
              <circle
                cx="28"
                cy="11"
                r="1.2"
                fill="url(#knobGradient)"
                stroke="#8b6914"
                stroke-width="0.3"
              />
              <circle
                cx="34"
                cy="11"
                r="1.2"
                fill="url(#knobGradient)"
                stroke="#8b6914"
                stroke-width="0.3"
              />
              <circle
                cx="40"
                cy="11"
                r="1.2"
                fill="url(#knobGradient)"
                stroke="#8b6914"
                stroke-width="0.3"
              />
              <line
                x1="16"
                y1="10"
                x2="16"
                y2="9.2"
                stroke="#fff"
                stroke-width="0.3"
              />
              <line
                x1="22"
                y1="10"
                x2="22"
                y2="9.2"
                stroke="#fff"
                stroke-width="0.3"
              />
              <line
                x1="28"
                y1="10"
                x2="28"
                y2="9.2"
                stroke="#fff"
                stroke-width="0.3"
              />
              <line
                x1="34"
                y1="10"
                x2="34"
                y2="9.2"
                stroke="#fff"
                stroke-width="0.3"
              />
              <line
                x1="40"
                y1="10"
                x2="40"
                y2="9.2"
                stroke="#fff"
                stroke-width="0.3"
              />
              <rect
                x="7"
                y="16"
                width="36"
                height="26"
                rx="1.5"
                fill="url(#grilleGradient)"
                stroke="#2a2a2a"
                stroke-width="0.5"
              />
              <g opacity="0.6">
                <line
                  x1="9"
                  y1="18"
                  x2="41"
                  y2="18"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="20"
                  x2="41"
                  y2="20"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="22"
                  x2="41"
                  y2="22"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="24"
                  x2="41"
                  y2="24"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="26"
                  x2="41"
                  y2="26"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="28"
                  x2="41"
                  y2="28"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="30"
                  x2="41"
                  y2="30"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="32"
                  x2="41"
                  y2="32"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="34"
                  x2="41"
                  y2="34"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="36"
                  x2="41"
                  y2="36"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="38"
                  x2="41"
                  y2="38"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="9"
                  y1="40"
                  x2="41"
                  y2="40"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="11"
                  y1="16"
                  x2="11"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="15"
                  y1="16"
                  x2="15"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="19"
                  y1="16"
                  x2="19"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="23"
                  y1="16"
                  x2="23"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="27"
                  y1="16"
                  x2="27"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="31"
                  y1="16"
                  x2="31"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="35"
                  y1="16"
                  x2="35"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
                <line
                  x1="39"
                  y1="16"
                  x2="39"
                  y2="42"
                  stroke="#1a1a1a"
                  stroke-width="0.3"
                />
              </g>
              <circle
                cx="25"
                cy="29"
                r="8"
                fill="none"
                stroke="#2a2a2a"
                stroke-width="0.5"
                opacity="0.5"
              />
              <circle
                cx="25"
                cy="29"
                r="5"
                fill="none"
                stroke="#3a3a3a"
                stroke-width="0.4"
                opacity="0.4"
              />
              <circle
                cx="8"
                cy="17"
                r="0.6"
                fill="#4a4a4a"
                stroke="#2a2a2a"
                stroke-width="0.2"
              />
              <circle
                cx="42"
                cy="17"
                r="0.6"
                fill="#4a4a4a"
                stroke="#2a2a2a"
                stroke-width="0.2"
              />
              <circle
                cx="8"
                cy="41"
                r="0.6"
                fill="#4a4a4a"
                stroke="#2a2a2a"
                stroke-width="0.2"
              />
              <circle
                cx="42"
                cy="41"
                r="0.6"
                fill="#4a4a4a"
                stroke="#2a2a2a"
                stroke-width="0.2"
              />
              <rect
                x="44"
                y="35"
                width="2"
                height="4"
                rx="0.5"
                fill="#2a2a2a"
                stroke="#1a1a1a"
                stroke-width="0.3"
              />
            </symbol>

            <!-- ============================================
           FLOOR MONITOR / WEDGE SYMBOL
           ============================================ -->
            <symbol id="monitor" viewBox="0 0 70 50">
              <defs>
                <linearGradient
                  id="monitorBodyGradient"
                  x1="0%"
                  y1="0%"
                  x2="0%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #3a3a3a; stop-opacity: 1"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #2a2a2a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #1a1a1a; stop-opacity: 1"
                  />
                </linearGradient>
                <linearGradient
                  id="speakerGradient"
                  x1="0%"
                  y1="0%"
                  x2="0%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #2a2a2a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #0a0a0a; stop-opacity: 1"
                  />
                </linearGradient>
              </defs>

              <!-- Monitor body (trapezoid shape - wedge) -->
              <path
                d="M 10 45 L 5 15 L 65 15 L 60 45 Z"
                fill="url(#monitorBodyGradient)"
                stroke="#000"
                stroke-width="1"
              />

              <!-- Front face (angled) -->
              <path
                d="M 5 15 L 35 5 L 65 15 Z"
                fill="#2a2a2a"
                stroke="#000"
                stroke-width="0.8"
              />

              <!-- Speaker grille -->
              <path
                d="M 12 40 L 8 20 L 62 20 L 58 40 Z"
                fill="url(#speakerGradient)"
                stroke="#1a1a1a"
                stroke-width="0.8"
              />

              <!-- Grille mesh pattern -->
              <g opacity="0.5">
                <line
                  x1="10"
                  y1="23"
                  x2="60"
                  y2="23"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
                <line
                  x1="10.5"
                  y1="26"
                  x2="59.5"
                  y2="26"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
                <line
                  x1="11"
                  y1="29"
                  x2="59"
                  y2="29"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
                <line
                  x1="11.5"
                  y1="32"
                  x2="58.5"
                  y2="32"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
                <line
                  x1="12"
                  y1="35"
                  x2="58"
                  y2="35"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
                <line
                  x1="12.5"
                  y1="38"
                  x2="57.5"
                  y2="38"
                  stroke="#0a0a0a"
                  stroke-width="0.4"
                />
              </g>

              <!-- Speaker cone outline -->
              <ellipse
                cx="35"
                cy="30"
                rx="12"
                ry="10"
                fill="none"
                stroke="#1a1a1a"
                stroke-width="0.6"
                opacity="0.6"
              />
              <ellipse
                cx="35"
                cy="30"
                rx="8"
                ry="6"
                fill="none"
                stroke="#2a2a2a"
                stroke-width="0.5"
                opacity="0.5"
              />

              <!-- Handle on top -->
              <rect
                x="30"
                y="7"
                width="10"
                height="3"
                rx="1"
                fill="#1a1a1a"
                stroke="#0a0a0a"
                stroke-width="0.5"
              />

              <!-- Logo/brand area -->
              <rect
                x="28"
                y="21"
                width="14"
                height="4"
                rx="1"
                fill="#1a1a1a"
                opacity="0.6"
              />

              <!-- Corner details -->
              <circle
                cx="13"
                cy="42"
                r="1"
                fill="#1a1a1a"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
              <circle
                cx="57"
                cy="42"
                r="1"
                fill="#1a1a1a"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
            </symbol>

            <!-- Microphone Stand Symbol --->
            <symbol id="mic-stand" viewBox="0 0 50 120">
              <!-- Base tripod legs - matte black powder coat -->
              <line
                x1="25"
                y1="115"
                x2="10"
                y2="115"
                stroke="#1a1a1a"
                stroke-width="3"
              />
              <line
                x1="25"
                y1="115"
                x2="40"
                y2="115"
                stroke="#1a1a1a"
                stroke-width="3"
              />

              <!-- Center post connector - black metal -->
              <line
                x1="25"
                y1="115"
                x2="25"
                y2="108"
                stroke="#2a2a2a"
                stroke-width="3"
              />

              <!-- Main vertical pole - brushed chrome/silver -->
              <line
                x1="25"
                y1="108"
                x2="25"
                y2="30"
                stroke="#8b8b8b"
                stroke-width="2.5"
              />

              <!-- Boom arm - chrome with slight shadow -->
              <line
                x1="25"
                y1="30"
                x2="35"
                y2="15"
                stroke="#9a9a9a"
                stroke-width="2"
              />

              <!-- Mic clip bottom - black plastic -->
              <ellipse
                cx="35"
                cy="12"
                rx="3"
                ry="4"
                fill="#1a1a1a"
                stroke="#404040"
                stroke-width="1"
              />

              <!-- Mic body - dark metal housing -->
              <ellipse
                cx="35"
                cy="8"
                rx="4"
                ry="6"
                fill="#2a2a2a"
                stroke="#505050"
                stroke-width="1.5"
              />

              <!-- Mic grille mesh - charcoal black -->
              <rect
                x="31"
                y="2"
                width="8"
                height="6"
                rx="1"
                fill="#1a1a1a"
                stroke="#3a3a3a"
                stroke-width="1"
              />

              <!-- Grille mesh lines - subtle gray -->
              <line
                x1="33"
                y1="3"
                x2="33"
                y2="7"
                stroke="#404040"
                stroke-width="0.5"
              />
              <line
                x1="35"
                y1="3"
                x2="35"
                y2="7"
                stroke="#404040"
                stroke-width="0.5"
              />
              <line
                x1="37"
                y1="3"
                x2="37"
                y2="7"
                stroke="#404040"
                stroke-width="0.5"
              />

              <!-- Boom arm joint - chrome knob -->
              <circle
                cx="25"
                cy="30"
                r="3"
                fill="#6a6a6a"
                stroke="#9a9a9a"
                stroke-width="1.5"
              />

              <!-- Height adjustment knob - smaller chrome detail -->
              <circle
                cx="25"
                cy="70"
                r="2.5"
                fill="#7a7a7a"
                stroke="#4a4a4a"
                stroke-width="1"
              />
            </symbol>

            <!-- Power Extension Cord Symbol (Horizontal) -->
            <symbol id="power-extension" viewBox="0 0 160 40">
              <defs>
                <linearGradient
                  id="powerStripGradient"
                  x1="0%"
                  y1="0%"
                  x2="0%"
                  y2="100%"
                >
                  <stop
                    offset="0%"
                    style="stop-color: #2a2a2a; stop-opacity: 1"
                  />
                  <stop
                    offset="50%"
                    style="stop-color: #1a1a1a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #0a0a0a; stop-opacity: 1"
                  />
                </linearGradient>
                <radialGradient id="outletGradient">
                  <stop
                    offset="0%"
                    style="stop-color: #0a0a0a; stop-opacity: 1"
                  />
                  <stop
                    offset="100%"
                    style="stop-color: #1a1a1a; stop-opacity: 1"
                  />
                </radialGradient>
              </defs>

              <!-- Main power strip housing -->
              <rect
                x="10"
                y="8"
                width="140"
                height="24"
                rx="3"
                fill="url(#powerStripGradient)"
                stroke="#000"
                stroke-width="0.8"
              />

              <!-- Top highlight -->
              <rect
                x="12"
                y="9"
                width="136"
                height="2"
                rx="1"
                fill="#3a3a3a"
                opacity="0.5"
              />

              <!-- Power cable (left side) -->
              <path
                d="M 10 20 Q 5 20 2 18"
                fill="none"
                stroke="#1a1a1a"
                stroke-width="4"
                stroke-linecap="round"
              />
              <path
                d="M 10 20 Q 5 20 2 18"
                fill="none"
                stroke="#0a0a0a"
                stroke-width="2.5"
                stroke-linecap="round"
              />

              <!-- Outlet 1 -->
              <rect
                x="25"
                y="14"
                width="18"
                height="12"
                rx="2"
                fill="url(#outletGradient)"
                stroke="#000"
                stroke-width="0.5"
              />
              <rect
                x="28"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <rect
                x="36"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <circle cx="33.5" cy="20" r="1.2" fill="#6a5511" />

              <!-- Outlet 2 -->
              <rect
                x="50"
                y="14"
                width="18"
                height="12"
                rx="2"
                fill="url(#outletGradient)"
                stroke="#000"
                stroke-width="0.5"
              />
              <rect
                x="53"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <rect
                x="61"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <circle cx="58.5" cy="20" r="1.2" fill="#6a5511" />

              <!-- Outlet 3 -->
              <rect
                x="75"
                y="14"
                width="18"
                height="12"
                rx="2"
                fill="url(#outletGradient)"
                stroke="#000"
                stroke-width="0.5"
              />
              <rect
                x="78"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <rect
                x="86"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <circle cx="83.5" cy="20" r="1.2" fill="#6a5511" />

              <!-- Outlet 4 -->
              <rect
                x="100"
                y="14"
                width="18"
                height="12"
                rx="2"
                fill="url(#outletGradient)"
                stroke="#000"
                stroke-width="0.5"
              />
              <rect
                x="103"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <rect
                x="111"
                y="17"
                width="3"
                height="6"
                rx="0.5"
                fill="#8b6914"
              />
              <circle cx="108.5" cy="20" r="1.2" fill="#6a5511" />

              <!-- Power switch (right side) -->
              <rect
                x="125"
                y="13"
                width="12"
                height="14"
                rx="1.5"
                fill="#1a1a1a"
                stroke="#000"
                stroke-width="0.5"
              />
              <rect
                x="127"
                y="15"
                width="8"
                height="5"
                rx="0.8"
                fill="#ff4444"
                stroke="#cc0000"
                stroke-width="0.4"
              />
              <text
                x="131"
                y="25"
                font-size="4"
                fill="#888"
                text-anchor="middle"
                font-family="Arial"
              >
                ON
              </text>

              <!-- Power indicator LED -->
              <circle cx="143" cy="20" r="2" fill="#ff4444" opacity="0.9" />
              <circle cx="143" cy="20" r="1.2" fill="#ff6666" />

              <!-- Mounting screws -->
              <circle
                cx="15"
                cy="13"
                r="1"
                fill="#2a2a2a"
                stroke="#1a1a1a"
                stroke-width="0.3"
              />
              <circle
                cx="145"
                cy="13"
                r="1"
                fill="#2a2a2a"
                stroke="#1a1a1a"
                stroke-width="0.3"
              />
              <circle
                cx="15"
                cy="27"
                r="1"
                fill="#2a2a2a"
                stroke="#1a1a1a"
                stroke-width="0.3"
              />
              <circle
                cx="145"
                cy="27"
                r="1"
                fill="#2a2a2a"
                stroke="#1a1a1a"
                stroke-width="0.3"
              />

              <!-- Screw details -->
              <line
                x1="14"
                y1="12"
                x2="16"
                y2="14"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
              <line
                x1="144"
                y1="12"
                x2="146"
                y2="14"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
              <line
                x1="14"
                y1="26"
                x2="16"
                y2="28"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
              <line
                x1="144"
                y1="26"
                x2="146"
                y2="28"
                stroke="#0a0a0a"
                stroke-width="0.3"
              />
            </symbol>
          </defs>

          <g id="viewport">
            <rect
              x="-5000"
              y="-5000"
              width="10000"
              height="10000"
              fill="url(#grid-major)"
            />
            <line x1="-5000" y1="0" x2="5000" y2="0" class="axis-line" />
            <line x1="0" y1="-5000" x2="0" y2="5000" class="axis-line" />
            <g id="stageNodes">
              <!-- Sample equipment - can be dragged -->
              <use
                href="#drumkit"
                x="-100"
                y="-100"
                width="100"
                height="100"
                class="draggable"
              />
              <use
                href="#amp"
                x="150"
                y="-50"
                width="80"
                height="80"
                class="draggable"
              />
              <use
                href="#amp"
                x="250"
                y="-50"
                width="80"
                height="80"
                class="draggable"
              />
              <use
                href="#monitor"
                x="-200"
                y="50"
                width="70"
                height="70"
                class="draggable"
              />
              <use
                href="#monitor"
                x="200"
                y="50"
                width="70"
                height="70"
                class="draggable"
              />
              <use
                href="#mic-stand"
                x="-50"
                y="-80"
                width="40"
                height="100"
                class="draggable"
              />
            </g>
          </g>
        </svg>

        <div class="stage-controls">
          <div class="control-group">
            <button class="stage-btn" id="zoomIn">Zoom In (+)</button>
            <button class="stage-btn" id="zoomOut">Zoom Out (−)</button>
          </div>
          <button class="stage-btn" id="resetView">Reset View</button>
        </div>

        <div class="stage-info">
          <div class="info-line">
            Zoom: <span class="info-value" id="zoomDisplay">100%</span>
          </div>
          <div class="info-line">
            Pan: <span class="info-value" id="panDisplay">0, 0</span>
          </div>
          <div class="info-line">
            Mouse: <span class="info-value" id="mouseDisplay">0, 0</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const dropdown = document.querySelector(".dropdown");
  const dropdownToggle = document.getElementById("techRiderToggle");
  const dropdownMenu = dropdown.querySelector(".dropdown-menu");
  const dropdownItems = dropdown.querySelectorAll(".dropdown-item");

  const isTouchDevice =
    "ontouchstart" in window || navigator.maxTouchPoints > 0;

  if (isTouchDevice) {
    dropdownToggle.addEventListener("click", (e) => {
      e.preventDefault();
      const isOpen = dropdown.classList.contains("is-open");
      dropdown.classList.toggle("is-open");
      dropdownToggle.setAttribute("aria-expanded", !isOpen);
    });

    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove("is-open");
        dropdownToggle.setAttribute("aria-expanded", "false");
      }
    });

    dropdownItems.forEach((item) => {
      item.addEventListener("click", () => {
        dropdown.classList.remove("is-open");
        dropdownToggle.setAttribute("aria-expanded", "false");
      });
    });
  }

  dropdownToggle.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      const isOpen = dropdown.classList.contains("is-open");
      dropdown.classList.toggle("is-open");
      dropdownToggle.setAttribute("aria-expanded", !isOpen);

      if (!isOpen) {
        setTimeout(() => {
          dropdownItems[0]?.focus();
        }, 100);
      }
    }
  });

  dropdownItems.forEach((item, index) => {
    item.addEventListener("keydown", (e) => {
      if (e.key === "ArrowDown") {
        e.preventDefault();
        const nextItem = dropdownItems[index + 1] || dropdownItems[0];
        nextItem.focus();
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        const prevItem =
          dropdownItems[index - 1] || dropdownItems[dropdownItems.length - 1];
        prevItem.focus();
      } else if (e.key === "Escape") {
        dropdown.classList.remove("is-open");
        dropdownToggle.setAttribute("aria-expanded", "false");
        dropdownToggle.focus();
      }
    });
  });
</script>
